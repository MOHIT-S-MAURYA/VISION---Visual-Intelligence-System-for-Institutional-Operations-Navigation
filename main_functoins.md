## üéØ Prototype Functional Overview

### Core Users

- **Teacher** ‚Äî Primary user for prototype (manages registration and attendance)
- **Student** ‚Äî Only appears as data; no login or direct interface

---

## üîë ID Generation Strategy (Automatic & Consistent)

### Overview

All primary keys are **automatically generated** by Django using `BigAutoField` (64-bit auto-incrementing integers). This ensures consistency, uniqueness, and reliability across the entire system.

### Primary Keys (Automatic)

1. **Student.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for Student model
   - Used in: FAISS index (as `student_id`), face embeddings

2. **Teacher.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for Teacher model

3. **Department.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for Department model

4. **Subject.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for Subject model

5. **TeacherSubjectAssignment.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for assignment tracking

6. **AttendanceSession.id** - Auto-generated by Django

   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for attendance sessions

7. **AttendanceRecord.id** - Auto-generated by Django
   - Type: `BigAutoField` (64-bit integer)
   - Generation: Automatic on save
   - Used as: Primary key for individual attendance records

### Secondary Identifiers

1. **Student.roll_number** - Auto-generated OR user input (optional, unique)

   - Type: `CharField(max_length=50)`
   - Constraints: Unique across all students
   - Generation: Auto-generated if not provided
   - Format (auto): `{DEPT_CODE}-{YEAR}-{SEQUENCE}`
   - Example (auto): "CSE-2025-00001", "ECE-2025-00015"
   - Example (manual): "CSE2024001" (any custom format)
   - Purpose: Human-readable student identifier
   - **How it works**:
     - If user provides roll_number ‚Üí Use as-is
     - If left blank ‚Üí Auto-generate: `{department.code}-2025-{sequence}`
     - Sequence increments per department per year

2. **Teacher.employee_id** - User input (optional, unique)

   - Type: `CharField(max_length=50)`
   - Constraints: Unique if provided, can be null/blank
   - Purpose: Institution's employee identification
   - Example: "T001"

3. **Department.code** - User input (required, unique)
   - Type: `CharField(max_length=20)`
   - Constraints: Unique across all departments
   - Purpose: Short department identifier
   - Example: "CSE", "ECE", "MCA"

### Face Recognition Identifiers

1. **Student.face_embedding_id** - AI service generated
   - Type: `CharField(max_length=100)`
   - Generation: Set to `str(student.id)` after Django creates student
   - Purpose: Links Django student record to FAISS index
   - Flow:
     1. Student created in Django ‚Üí `student.id` auto-generated
     2. Frames sent to AI service with `student_id: str(student.id)`
     3. AI service stores embedding in FAISS with this ID
     4. Django saves `face_embedding_id = student.id`
   - Fallback: `f"pending_{student.id}"` if AI service fails

### Data Flow Example

```python
# Student Registration Flow (with auto-generated roll number):
# 1. Frontend submits form with empty roll_number, name, department, frames
# 2. Django creates Student instance
student = Student.objects.create(
    roll_number="",             # Empty - will auto-generate
    full_name="John Doe",       # User input
    department=dept_obj,        # Foreign key (e.g., CSE department)
    class_year="First Year"     # User input
)
# During save():
#   - student.id is auto-generated (e.g., 42)
#   - roll_number auto-generated: "CSE-2025-00001"

# 3. Backend sends to AI service
data = {'student_id': str(student.id)}  # "42"

# 4. AI service stores in FAISS
self.student_ids.append(student_id)  # ["42"]
self.index.add(embedding)

# 5. Django updates with embedding_id
student.face_embedding_id = "42"  # Same as student.id
student.save()

# Alternative: Manual roll number
student = Student.objects.create(
    roll_number="CUSTOM-2024-001",  # User provides custom format
    full_name="Jane Smith",
    department=dept_obj,
    class_year="Second Year"
)
# roll_number remains "CUSTOM-2024-001" (user-provided value used)

# Recognition Flow:
# 1. AI service recognizes face ‚Üí returns student_id: "42"
# 2. Backend queries: Student.objects.get(id=42)
# 3. Attendance marked for student with id=42
```

### Consistency Guarantees

‚úÖ **Primary Keys**: All auto-generated, no conflicts possible  
‚úÖ **FAISS Index**: Uses `str(student.id)` - guaranteed unique  
‚úÖ **Roll Numbers**: Validated unique at database level  
‚úÖ **Employee IDs**: Validated unique at database level (if provided)  
‚úÖ **Department Codes**: Validated unique at database level

### Settings Configuration

```python
# backend/attendance_system/settings.py
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
```

This ensures all models use 64-bit auto-incrementing integers for primary keys.

---

## üöÄ Core Functionalities

### 1. **Student Registration**

#### Goal

Register a new student with their details and facial embedding (captured live from the camera).

#### Workflow

1. **Navigate to Registration Page**

   - Form fields:

     - Full Name
     - Roll Number / ID
     - Department (dropdown or input)
     - Class / Year

   - ‚ÄúOpen Camera‚Äù button

2. **Live Face Capture**

   - Opens webcam feed inside the form.
   - The teacher clicks **‚ÄúCapture Face‚Äù** ‚Äî the app:

     - Takes 3‚Äì5 frames of the student.
     - Sends them to backend `/api/face/register` endpoint (FastAPI service).
     - Backend extracts **face embeddings** using **FaceNet / DeepFace** and stores:

       - Student metadata (name, roll number, dept, class)
       - Face embeddings in **FAISS** index.
       - Reference image (optional) in Media/Storage service (e.g., S3/local).

3. **Confirmation**

   - Displays ‚Äú‚úÖ Student Registered Successfully‚Äù
   - Shows thumbnail of captured face.

#### Technical Flow

- **Frontend**: React + Camera API ‚Üí Base64 image ‚Üí POST to `/api/face/register`
- **Backend (FastAPI)**: Extract embeddings ‚Üí Store in FAISS ‚Üí Return success response
- **Database**: Student details + embedding ID linked.

---

### 2. **Start Attendance**

#### Goal

Automatically mark attendance using the live camera for a selected class and subject.

#### Workflow

1. **Navigate to Attendance Page**

   - Dropdowns:

     - Department
     - Class / Year
     - Subject

   - ‚ÄúStart Attendance‚Äù button.

2. **Live Detection Mode**

   - Opens webcam in full screen.
   - Streams frames to backend `/api/face/recognize`.
   - Backend compares embeddings (FAISS search) ‚Üí identifies known faces ‚Üí marks attendance in database.

3. **Real-Time UI**

   - Detected student faces appear in a grid with:

     - Name
     - Roll Number
     - Confidence %
     - ‚úÖ ‚ÄúPresent‚Äù badge

4. **Stop Attendance**

   - ‚ÄúStop Session‚Äù button ‚Üí ends capture session.
   - Attendance summary table appears:

     | Roll No | Name         | Status     | Time     |
     | ------- | ------------ | ---------- | -------- |
     | 01      | Mohit Maurya | ‚úÖ Present | 09:45 AM |
     | 02      | Priya Singh  | ‚ùå Absent  | ‚Äî        |

5. **Save Report**

   - Option to export as `.csv` or `.pdf`
   - Automatically stored in backend under `/api/attendance/session/<id>/report`

#### Technical Flow

- **Frontend**: React camera stream ‚Üí WebSocket or interval POST to `/api/face/recognize`
- **Backend (FastAPI)**: Match embeddings ‚Üí Respond with recognized student info
- **Backend (DRF)**: Update attendance DB ‚Üí Return session report
- **Frontend**: Render dynamic recognition results.

---

## üß† Design Philosophy

- **Simplicity**: Two major pages ‚Üí Register & Attendance.
- **Minimal Interaction**: Teacher can operate with minimal clicks.
- **Live Camera Only**: No photo uploads; all real-time.
- **Modern UI**: Tailwind CSS + React animations.
- **Instant Feedback**: Loading states, success toasts, and clear confirmation messages.

---

## üß© Prototype Pages (Frontend)

| Page               | Path          | Description                             |
| ------------------ | ------------- | --------------------------------------- |
| `Login`            | `/login`      | Simple login for teacher                |
| `Register Student` | `/register`   | Add student details + capture face      |
| `Attendance`       | `/attendance` | Start/stop live camera-based attendance |
| `Reports`          | `/reports`    | View and export attendance records      |

---

## ‚öôÔ∏è Tech Stack Overview

| Layer                  | Technology                   | Description                                |
| ---------------------- | ---------------------------- | ------------------------------------------ |
| **Frontend**           | React + TailwindCSS          | Clean UI with responsive design            |
| **Backend API (Core)** | Django REST Framework        | Handles attendance data, user, and storage |
| **AI / Vision Engine** | FastAPI + DeepFace / FaceNet | Handles embedding creation and recognition |
| **Database**           | SQLite + FAISS Vector DB     | Relational + vector search hybrid          |
| **Media Storage**      | Local /                      | Stores face images or session captures     |

---
